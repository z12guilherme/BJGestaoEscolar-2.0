<<<<<<< HEAD
{% extends "base.html" %}

{% block title %}Adicionar Nota{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card login-card">
            <div class="card-header">
                <h3 class="card-title text-center">Adicionar Nota</h3>
            </div>
            <div class="card-body">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'danger' else 'success' }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <form id="addNotaForm" method="POST">
                    <div class="mb-3">
                        <label for="turma_id" class="form-label">Turma</label>
                        <select class="form-select" id="turma_id" name="turma_id" required onchange="loadAlunos()">
                            <option value="">Selecione uma turma</option>
                            {% for turma in turmas %}
                                <option value="{{ turma.id }}">{{ turma.name }} ({{ turma.year or 'N/A' }}) - {{ turma.school.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="student_id" class="form-label">Aluno</label>
                        <select class="form-select" id="student_id" name="student_id" required disabled>
                            <option value="">Selecione um aluno</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="semestre" class="form-label">Semestre</label>
                        <input type="text" class="form-control" id="semestre" name="semestre" placeholder="Ex: 2025/1" required>
                    </div>
                    <div class="mb-3">
                        <label for="valor" class="form-label">Valor da Nota</label>
                        <input type="number" step="0.01" min="0" max="10" class="form-control" id="valor" name="valor" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Salvar Nota</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function loadAlunos() {
    const turmaId = document.getElementById('turma_id').value;
    const alunoSelect = document.getElementById('student_id');
    if (!turmaId) {
        alunoSelect.innerHTML = '<option value="">Selecione um aluno</option>';
        alunoSelect.disabled = true;
        return;
    }

    fetch(`/get_alunos/${turmaId}`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert('Erro ao carregar alunos: ' + data.error);
                return;
            }
            alunoSelect.innerHTML = '<option value="">Selecione um aluno</option>';
            data.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                alunoSelect.appendChild(option);
            });
            alunoSelect.disabled = false;
        })
        .catch(error => {
            console.error('Erro:', error);
            alert('Erro ao carregar alunos.');
        });
}
</script>
{% endblock %}
=======
{% extends "base.html" %}

{% block title %}Adicionar Nota{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card login-card">
            <div class="card-header">
                <h3 class="card-title text-center">Adicionar Nota</h3>
            </div>
            <div class="card-body">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'danger' else 'success' }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <form id="addNotaForm" method="POST">
                    <div class="mb-3">
                        <label for="turma_id" class="form-label">Turma</label>
                        <select class="form-select" id="turma_id" name="turma_id" required onchange="loadAlunos()">
                            <option value="">Selecione uma turma</option>
                            {% for turma in turmas %}
                                <option value="{{ turma.id }}">{{ turma.name }} ({{ turma.year or 'N/A' }}) - {{ turma.school.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="student_id" class="form-label">Aluno</label>
                        <select class="form-select" id="student_id" name="student_id" required disabled>
                            <option value="">Selecione um aluno</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="semestre" class="form-label">Semestre</label>
                        <input type="text" class="form-control" id="semestre" name="semestre" placeholder="Ex: 2025/1" required>
                    </div>
                    <div class="mb-3">
                        <label for="valor" class="form-label">Valor da Nota</label>
                        <input type="number" step="0.01" min="0" max="10" class="form-control" id="valor" name="valor" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Salvar Nota</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function loadAlunos() {
    const turmaId = document.getElementById('turma_id').value;
    const alunoSelect = document.getElementById('student_id');
    if (!turmaId) {
        alunoSelect.innerHTML = '<option value="">Selecione um aluno</option>';
        alunoSelect.disabled = true;
        return;
    }

    fetch(`/get_alunos/${turmaId}`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert('Erro ao carregar alunos: ' + data.error);
                return;
            }
            alunoSelect.innerHTML = '<option value="">Selecione um aluno</option>';
            data.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                alunoSelect.appendChild(option);
            });
            alunoSelect.disabled = false;
        })
        .catch(error => {
            console.error('Erro:', error);
            alert('Erro ao carregar alunos.');
        });
}
</script>
{% endblock %}
>>>>>>> db5166d083e57d9cff6cad4f9277596e8fdc09f1
